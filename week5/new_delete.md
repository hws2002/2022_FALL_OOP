## **对象的new和delete**

### **生成一个类对象的数组**

```C
A *pA = new A[3];
```
①调用operator new[ ] 标准库函数来分配足够大的原始未类型化的内存。
注意要多出4个字节来存放数组的大小。

②在刚分配的内存上运行构造函数对新建的对象进行初始化构造。

③返回指向新分配并构造好的对象数组的指针。

### **删除该对象数组及数组中的每个元素（释放内存资源）**

```C++
delete []pA;
```
①对数组中各个对象运行析构函数，数组的维数保存在pA前4个字节里。

②调用operator delete[ ]标准库函数释放申请的空间。
不仅仅释放对象数组所占的空间，还有上面的4个字节。



### 如果同时使用new[]和delete，会有什么后果？
该delete命令做了两件事：
调用一次 pA 指向的对象的析构函数。
释放pA地址的内存。
后果如下：
**只调用一次析构函数。如果类对象中有大量申请内存的操作，那么因为没有调用析构函数，这些内存无法被释放，造成内存泄漏。**

**直接释放pA指向的内存空间，这个会造成严重的段错误，程序必然会崩溃。因为分配空间的起始地址是pA-4byte。（delete[] pA的释放地址自动转换为pA-4byte）**


